const __vite__fileDeps=["index-C9ULowyk-DahgpQ6x.js","strapi-BZZ6vgbi.js","strapi-COJtagOC.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{fP as Ge,a$ as q,aX as v,fQ as d,r as y,j as e,P as w,R as _e,a as je,aw as Ne,fR as He,av as Se,bC as ke,fS as We,fT as P,fU as Ke,fV as Xe,fW as Ye,fX as Ze,fY as Je,fZ as E,f_ as es,L as $,I as W,bK as Le,bl as ss,eF as ts,f$ as as,eh as os,bt as ns,ad as Re,g0 as is,g1 as rs,g2 as ls,Q as Y,g3 as ds,g4 as cs,g5 as us,F as O,V as gs,C as fs,B as Q,bj as ps,g6 as hs,b2 as K,g7 as ms,g8 as xs,g9 as js,bM as bs,S as k,bs as Z,b as ys,a6 as vs,a7 as Cs,ga as Fs,d as J,aq as be,ar as Ms,gb as Ss,gc as ye,gd as ks,T as ee,ge as Ls,cg as Rs,gf as ws,gg as As,bx as ve,bv as Es,by as Ts,M as b,el as Ds,gh as Bs,b9 as Is,N as Ps,O as $s,U as Ce,gi as qs,h as Os,g as Qs,i as Us,q as Vs,gj as X,gk as zs,fh as Gs,Y as g,gl as U,gm as L,gn as _s}from"./strapi-BZZ6vgbi.js";const Ns=(s,{pathname:a,query:o})=>{let n=[{id:null,label:{id:d("plugin.name"),defaultMessage:"Media Library"},href:s?E(a,o||{}):void 0}];return s?.parent&&typeof s?.parent!="number"&&s?.parent?.parent&&n.push([]),s?.parent&&typeof s.parent!="number"&&n.push({id:s.parent.id,label:s.parent.name,href:E(a,o||{},{folder:s.parent.id?.toString(),folderPath:s.parent.path})}),s&&n.push({id:s.id,label:s.name}),n},Hs=s=>{const{id:a}=ws();return e.jsx(Q,{position:"relative",zIndex:2,children:e.jsx(Re,{"aria-labelledby":`${a}-title`,...s})})},we=({selected:s,onSuccess:a})=>{const{formatMessage:o}=v(),{remove:n}=As(),l=async()=>{await n(s),a()};return e.jsxs(ve.Root,{children:[e.jsx(ve.Trigger,{children:e.jsx(k,{variant:"danger-light",size:"S",startIcon:e.jsx(Es,{}),children:o({id:"global.delete",defaultMessage:"Delete"})})}),e.jsx(Ts,{onConfirm:l})]})};we.propTypes={selected:g.arrayOf(U,L).isRequired,onSuccess:g.func.isRequired};const Ws=()=>{const{formatMessage:s}=v(),{toggleNotification:a}=Os(),o=Qs(),{post:n}=Us(),i=Vs(({destinationFolderId:h,filesAndFolders:p})=>{const c=p.reduce((u,M)=>{const{id:r,type:S}=M,m=S==="asset"?"fileIds":"folderIds";return u[m]||(u[m]=[]),u[m].push(r),u},{});return n("/upload/actions/bulk-move",{...c,destinationFolderId:h})},{onSuccess(h){const{data:{data:p}}=h;p?.files?.length>0&&(o.refetchQueries([X,"assets"],{active:!0}),o.refetchQueries([X,"asset-count"],{active:!0})),o.refetchQueries([X,"folders"],{active:!0}),a({type:"success",message:s({id:d("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."})})}});return{...i,move:(h,p)=>i.mutateAsync({destinationFolderId:h,filesAndFolders:p})}},se=({onClose:s,selected:a,currentFolder:o})=>{const{formatMessage:n}=v(),{data:l,isLoading:i}=Bs(),{move:f}=Ws();if(!l)return null;const h=async(c,{setErrors:u})=>{try{await f(c.destination.value,a),s()}catch(M){const S=zs(M).errors.reduce((m,T)=>(m[T.values?.path?.length||"destination"]=T.defaultMessage,m),{});Gs(S)||u(S)}};if(i)return e.jsx(b.Content,{children:e.jsx(b.Body,{children:e.jsx(O,{justifyContent:"center",paddingTop:4,paddingBottom:4,children:e.jsx(Is,{children:n({id:d("content.isLoading"),defaultMessage:"Content is loading."})})})})});const p={destination:{value:o?.id||"",label:o?.name||l[0].label}};return e.jsx(b.Content,{children:e.jsx(Ps,{validateOnChange:!1,onSubmit:h,initialValues:p,children:({values:c,errors:u,setFieldValue:M})=>e.jsxs($s,{noValidate:!0,children:[e.jsx(b.Header,{children:e.jsx(b.Title,{children:n({id:d("modal.folder.move.title"),defaultMessage:"Move elements to"})})}),e.jsx(b.Body,{children:e.jsx(Y.Root,{gap:4,children:e.jsx(Y.Item,{xs:12,col:12,direction:"column",alignItems:"stretch",children:e.jsxs(Ce.Root,{id:"folder-destination",children:[e.jsx(Ce.Label,{children:n({id:d("form.input.label.folder-location"),defaultMessage:"Location"})}),e.jsx(qs,{options:l,onChange:r=>{M("destination",r)},defaultValue:c.destination,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:u?.destination,ariaErrorMessage:"destination-error"}),u.destination&&e.jsx(ee,{variant:"pi",tag:"p",textColor:"danger600",children:u.destination})]})})})}),e.jsxs(b.Footer,{children:[e.jsx(b.Close,{children:e.jsx(k,{variant:"tertiary",name:"cancel",children:n({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(k,{type:"submit",loading:i,children:n({id:"modal.folder.move.submit",defaultMessage:"Move"})})]})]})})})};se.defaultProps={currentFolder:void 0,selected:[]};se.propTypes={onClose:g.func.isRequired,currentFolder:L,selected:g.arrayOf(L,U)};const te=({selected:s,onSuccess:a,currentFolder:o})=>{const{formatMessage:n}=v(),[l,i]=y.useState(!1),f=()=>{i(!1),a()};return e.jsxs(b.Root,{open:l,onOpenChange:i,children:[e.jsx(b.Trigger,{children:e.jsx(k,{variant:"secondary",size:"S",startIcon:e.jsx(Ds,{}),children:n({id:"global.move",defaultMessage:"Move"})})}),e.jsx(se,{currentFolder:o,onClose:f,selected:s})]})};te.defaultProps={currentFolder:void 0,selected:[]};te.propTypes={onSuccess:g.func.isRequired,currentFolder:L,selected:g.arrayOf(U,L)};const ae=({selected:s,onSuccess:a,currentFolder:o})=>{const{formatMessage:n}=v(),l=s.reduce(function(i,f){return f?.type==="folder"?i+f.files.count:i+1},0);return e.jsxs(O,{gap:2,paddingBottom:5,children:[e.jsx(ee,{variant:"epsilon",textColor:"neutral600",children:n({id:d("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:s.filter(({type:i})=>i==="folder").length,numberAssets:l})}),e.jsx(we,{selected:s,onSuccess:a}),e.jsx(te,{currentFolder:o,selected:s,onSuccess:a})]})};ae.defaultProps={currentFolder:void 0,selected:[]};ae.propTypes={onSuccess:g.func.isRequired,currentFolder:L,selected:g.arrayOf(U,L)};const Ks=({isFiltering:s,canCreate:a,canRead:o})=>s?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:o?a?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},Ae=({canCreate:s,isFiltering:a,canRead:o,onActionClick:n})=>{const{formatMessage:l}=v(),i=Ks({isFiltering:a,canCreate:s,canRead:o});return e.jsx(Ls,{icon:o?void 0:Rs,action:s&&!a&&e.jsx(k,{variant:"secondary",startIcon:e.jsx(Z,{}),onClick:n,children:l({id:d("header.actions.add-assets"),defaultMessage:"Add new assets"})}),content:l({...i,id:d(i.id)})})};Ae.propTypes={canCreate:g.bool.isRequired,canRead:g.bool.isRequired,isFiltering:g.bool.isRequired,onActionClick:g.func.isRequired};const Xs=()=>{const[s,a]=y.useState(!1),{formatMessage:o}=v(),{trackUsage:n}=ke(),[{query:l},i]=q(),f=l?.filters?.$and||[],h=c=>{i({filters:{$and:c},page:1})},p=c=>{n("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(c[c.length-1])[0]}),i({filters:{$and:c},page:1})};return e.jsxs(be.Root,{open:s,onOpenChange:a,children:[e.jsx(be.Trigger,{children:e.jsx(k,{variant:"tertiary",startIcon:e.jsx(Ms,{}),size:"S",children:o({id:"app.utils.filters",defaultMessage:"Filters"})})}),e.jsx(Ss,{displayedFilters:ye,filters:f,onSubmit:p,onToggle:a}),e.jsx(ks,{appliedFilters:f,filtersSchema:ye,onRemoveFilter:h})]})},oe=({breadcrumbs:s,canCreate:a,folder:o,onToggleEditFolderDialog:n,onToggleUploadAssetDialog:l})=>{const{formatMessage:i}=v(),{pathname:f}=Se(),[{query:h}]=q(),p={...h,folder:o?.parent?.id??void 0,folderPath:o?.parent?.path??void 0};return e.jsx($.Header,{title:i({id:d("plugin.name"),defaultMessage:"Media Library"}),subtitle:s&&o&&e.jsx(Fs,{tag:"nav",label:i({id:d("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:s,currentFolderId:o?.id}),navigationAction:o&&e.jsx(ys,{tag:vs,startIcon:e.jsx(Cs,{}),to:`${f}?${Le.stringify(p,{encode:!1})}`,children:i({id:d("header.actions.folder-level-up"),defaultMessage:"Back"})}),primaryAction:a&&e.jsxs(O,{gap:2,children:[e.jsx(k,{startIcon:e.jsx(Z,{}),variant:"secondary",onClick:n,children:i({id:d("header.actions.add-folder"),defaultMessage:"Add new folder"})}),e.jsx(k,{startIcon:e.jsx(Z,{}),onClick:l,children:i({id:d("header.actions.add-assets"),defaultMessage:"Add new assets"})})]})})};oe.defaultProps={breadcrumbs:!1,folder:null};oe.propTypes={breadcrumbs:g.oneOfType([_s,g.bool]),canCreate:g.bool.isRequired,folder:L,onToggleEditFolderDialog:g.func.isRequired,onToggleUploadAssetDialog:g.func.isRequired};const Ys=J(Q)`
  height: 3.2rem;
  display: flex;
  align-items: center;
`,Fe=J(ee)`
  max-width: 100%;
`,Me=J(Q)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }
`,Zs=()=>{const s=Ne(),{canRead:a,canCreate:o,canUpdate:n,canCopyLink:l,canDownload:i,canConfigureView:f,isLoading:h}=He(),p=y.useRef(),{formatMessage:c}=v(),{pathname:u}=Se(),{trackUsage:M}=ke(),[{query:r},S]=q(),m=!!(r._q||r.filters),[T,Ee]=We(Ke.view,P.GRID),R=T===P.GRID,{data:C,isLoading:Te,errors:De}=Xe({skipWhen:!a,query:r}),{data:Be,isLoading:Ie,errors:Pe}=Ye({enabled:a&&C?.pagination?.page===1&&!Ze(r),query:r}),{data:V,isLoading:ne,error:$e}=Je(r?.folder,{enabled:a&&!!r?.folder});$e?.response?.status===404&&s(u);const D=Be?.map(t=>({...t,type:"folder",folderURL:E(u,r,t.id),isSelectable:n}))??[],x=D?.length||0,B=C?.results?.map(t=>({...t,type:"asset",isSelectable:n}))||[],j=B?.length??0,qe=C?.pagination?.total,Oe=ne||Ie||h||Te,[ie,Qe]=y.useState(!1),[re,le]=y.useState(!1),[z,G]=y.useState(void 0),[_,de]=y.useState(void 0),[F,{selectOne:I,selectAll:ce}]=es(["type","id"],[]),ue=F?.length>0&&F?.length!==j+x,N=()=>Qe(t=>!t),ge=({created:t=!1}={})=>{t&&r?.page!=="1"&&S({...r,page:1}),le(A=>!A)},fe=(t,A)=>{t&&M("didSelectAllMediaLibraryElements"),ce(A)},pe=t=>{M("didSortMediaLibraryElements",{location:"upload",sort:t}),S({sort:t})},he=t=>{de(t),le(!0)},Ue=t=>{de(null),ge(t),p.current&&p.current.focus()},me=t=>{t===j&&C.pagination.page===C.pagination.pageCount&&C.pagination.page>1&&S({...r,page:C.pagination.page-1})},Ve=()=>{ce(),me(F.length)};return Oe?e.jsx(w.Loading,{}):De||Pe?e.jsx(w.Error,{}):e.jsxs($.Root,{children:[e.jsxs(w.Main,{children:[e.jsx(oe,{breadcrumbs:!ne&&Ns(V,{pathname:u,query:r}),canCreate:o,onToggleEditFolderDialog:ge,onToggleUploadAssetDialog:N,folder:V}),e.jsx($.Action,{startActions:e.jsxs(e.Fragment,{children:[n&&R&&(j>0||x>0)&&e.jsx(Ys,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200",children:e.jsx(Re,{"aria-label":c({id:d("bulk.select.label"),defaultMessage:"Select all folders & assets"}),checked:ue?"indeterminate":(j>0||x>0)&&F.length===j+x,onCheckedChange:t=>fe(t,[...B,...D])})}),a&&R&&e.jsx(is,{value:r?.sort,onChangeSort:pe}),a&&e.jsx(Xs,{})]}),endActions:e.jsxs(e.Fragment,{children:[f?e.jsx(Me,{paddingTop:1,paddingBottom:1,children:e.jsx(W,{tag:ss,to:{pathname:`${u}/configuration`,search:Le.stringify(r,{encode:!1})},label:c({id:"app.links.configure-view",defaultMessage:"Configure the view"}),children:e.jsx(ts,{})})}):null,e.jsx(Me,{paddingTop:1,paddingBottom:1,children:e.jsx(W,{label:c(R?{id:d("view-switch.list"),defaultMessage:"List View"}:{id:d("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>Ee(R?P.LIST:P.GRID),children:R?e.jsx(as,{}):e.jsx(os,{})})}),e.jsx(ns,{label:c({id:d("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})]})}),e.jsxs($.Content,{children:[F.length>0&&e.jsx(ae,{currentFolder:V,selected:F,onSuccess:Ve}),x===0&&j===0&&e.jsx(Ae,{canCreate:o,canRead:a,isFiltering:m,onActionClick:N}),a&&!R&&(j>0||x>0)&&e.jsx(rs,{assetCount:j,folderCount:x,indeterminate:ue,onChangeSort:pe,onChangeFolder:(t,A)=>s(E(u,r,{folder:t,folderPath:A})),onEditAsset:G,onEditFolder:he,onSelectOne:I,onSelectAll:fe,rows:[...D,...B],selected:F,shouldDisableBulkSelect:!n,sortQuery:r?.sort??""}),a&&R&&e.jsxs(e.Fragment,{children:[x>0&&e.jsx(ls,{title:(m&&j>0||!m)&&c({id:d("list.folders.title"),defaultMessage:"Folders ({count})"},{count:x})||"",children:D.map(t=>{const ze=!!F.filter(({type:H})=>H==="folder").find(H=>H.id===t.id),xe=E(u,r,{folder:t?.id,folderPath:t?.path});return e.jsx(Y.Item,{col:3,direction:"column",alignItems:"stretch",children:e.jsx(ds,{ref:_&&t.id===_.id?p:void 0,ariaLabel:t.name,id:`folder-${t.id}`,to:xe,startAction:I&&t.isSelectable?e.jsx(Hs,{"data-testid":`folder-checkbox-${t.id}`,checked:ze,onCheckedChange:()=>I(t)}):null,cardActions:e.jsx(W,{"aria-label":c({id:d("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>he(t),children:e.jsx(fs,{})}),children:e.jsx(cs,{children:e.jsx(us,{to:xe,children:e.jsxs(O,{tag:"h2",direction:"column",alignItems:"start",maxWidth:"100%",children:[e.jsxs(Fe,{fontWeight:"semiBold",textColor:"neutral800",ellipsis:!0,children:[t.name,e.jsx(gs,{children:":"})]}),e.jsx(Fe,{tag:"span",textColor:"neutral600",variant:"pi",ellipsis:!0,children:c({id:d("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:t.children.count,filesCount:t.files.count})})]})})})})},`folder-${t.id}`)})}),j>0&&x>0&&e.jsx(Q,{paddingTop:6,paddingBottom:4,children:e.jsx(ps,{})}),j>0&&e.jsx(hs,{assets:B,onEditAsset:G,onSelectAsset:I,selectedAssets:F.filter(({type:t})=>t==="asset"),title:(!m||m&&x>0)&&C?.pagination?.page===1&&c({id:d("list.assets.title"),defaultMessage:"Assets ({count})"},{count:qe})||""})]}),e.jsxs(K.Root,{...C.pagination,children:[e.jsx(K.PageSize,{}),e.jsx(K.Links,{})]})]})]}),ie&&e.jsx(ms,{open:ie,onClose:N,trackedLocation:"upload",folderId:r?.folder}),re&&e.jsx(xs,{open:re,onClose:Ue,folder:_,parentFolderId:r?.folder,location:"upload"}),z&&e.jsx(js,{onClose:t=>{t===null&&me(1),G(void 0)},open:!!z,asset:z,canUpdate:n,canCopyLink:l,canDownload:i,trackedLocation:"upload"})]})},Js=y.lazy(()=>bs(()=>import("./index-C9ULowyk-DahgpQ6x.js"),__vite__mapDeps([0,1,2]))),st=()=>{const{config:{isLoading:s,isError:a,data:o}}=Ge(),[{rawQuery:n},l]=q(),{formatMessage:i}=v(),f=i({id:d("plugin.name"),defaultMessage:"Media Library"});return y.useEffect(()=>{s||a||n||l({sort:o.sort,page:1,pageSize:o.pageSize})},[s,a,o,n,l]),s?e.jsxs(e.Fragment,{children:[e.jsx(w.Title,{children:f}),e.jsx(w.Loading,{})]}):e.jsx(w.Main,{children:n?e.jsx(y.Suspense,{fallback:e.jsx(w.Loading,{}),children:e.jsxs(_e,{children:[e.jsx(je,{index:!0,element:e.jsx(Zs,{})}),e.jsx(je,{path:"configuration",element:e.jsx(Js,{config:o})})]})}):null})};export{st as default};
