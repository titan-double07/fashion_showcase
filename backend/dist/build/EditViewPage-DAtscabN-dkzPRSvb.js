import{av as N,a$ as O,u as Q,h as $,d7 as k,r as R,da as G,d2 as U,j as t,P as d,bo as Y,a0 as q,f0 as H,cK as m,f1 as j,Q as c,f2 as K,f3 as _,f4 as J,bB as W,m as X,c$ as Z,f5 as tt,d as st,F as P,B as et,d0 as at}from"./strapi-BZZ6vgbi.js";import{a as nt,f as it,t as rt,g as I}from"./Field-D-mgn1tH-CkwzAvOM.js";import"./Relations-BIGPMSW4-CW7Avq1d.js";import"./useDragAndDrop-DdHgKsqq-iXtGT5XL.js";import"./relations-BlpLgngh-Ba5iYp4O.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-BKbTzOrx.js";import"./objects-D6yBsdmx-CCNF9SF4.js";import"./useDebounce-DmuSJIF3-6u9jyW-T.js";const ot=a=>R.useEffect(a,dt),dt=[],S=({layout:a})=>t.jsx(P,{direction:"column",alignItems:"stretch",gap:6,children:a.map((n,o)=>{if(n.some(e=>e.some(s=>s.type==="dynamiczone"))){const[e]=n,[s]=e;return t.jsx(c.Root,{gap:4,children:t.jsx(c.Item,{col:12,s:12,xs:12,direction:"column",alignItems:"stretch",children:t.jsx(I,{...s})})},s.name)}return t.jsx(et,{hasRadius:!0,background:"neutral0",shadow:"tableShadow",paddingLeft:6,paddingRight:6,paddingTop:6,paddingBottom:6,borderColor:"neutral150",children:t.jsx(P,{direction:"column",alignItems:"stretch",gap:6,children:n.map((e,s)=>t.jsx(c.Root,{gap:4,children:e.map(({size:r,...u})=>t.jsx(c.Item,{col:r,s:12,xs:12,direction:"column",alignItems:"stretch",children:t.jsx(I,{...u})},u.name))},s))})},o)})}),ct=()=>{const a=N(),[{query:{status:n}},o]=O({status:"draft"}),{formatMessage:e}=Q(),{toggleNotification:s}=$(),{document:r,meta:u,isLoading:T,schema:l,components:g,collectionType:v,id:C,model:D,hasError:B}=k(),p=l?.options?.draftAndPublish??!1;ot(()=>{a?.state&&"error"in a.state&&s({type:"danger",message:a.state.error,timeout:5e3})});const A=G("EditViewPage",i=>i.isLoading),f=v===tt,h=!C&&!f,{isLoading:F,edit:{layout:b,settings:{mainField:x}}}=U(D),{isLazyLoading:M}=nt([]),w=A||T||F||M,L=R.useMemo(()=>{if(!r&&!h&&!f||!l)return;const i=r?.id?r:it(l,g);return rt(l,g)(i)},[r,h,f,l,g]);if(B)return t.jsx(d.Error,{});if(w&&!r?.documentId)return t.jsx(d.Loading,{});if(!L)return t.jsx(d.Error,{});const V=i=>{(i==="published"||i==="draft")&&o({status:i},"push",!0)},y=x!=="id"&&r?.[x]?r[x]:"Untitled";return t.jsxs(Y,{paddingLeft:10,paddingRight:10,children:[t.jsx(d.Title,{children:`${y}`}),t.jsx(q,{disabled:p&&n==="published",initialValues:L,method:h?"POST":"PUT",validate:(i,z)=>J(l?.attributes,g,{status:n,...z}).validate(i,{abortEarly:!1}),children:({resetForm:i})=>t.jsxs(t.Fragment,{children:[t.jsx(H,{isCreating:h,status:p?ut(r,u):void 0,title:y}),t.jsxs(m.Root,{variant:"simple",value:n,onValueChange:V,children:[t.jsx(m.List,{"aria-label":e({id:j("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:p?t.jsxs(t.Fragment,{children:[t.jsx(E,{value:"draft",children:e({id:j("containers.edit.tabs.draft"),defaultMessage:"draft"})}),t.jsx(E,{disabled:!u||u.availableStatus.length===0,value:"published",children:e({id:j("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),t.jsxs(c.Root,{paddingTop:8,gap:4,children:[t.jsxs(c.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[t.jsx(m.Content,{value:"draft",children:t.jsx(S,{layout:b})}),t.jsx(m.Content,{value:"published",children:t.jsx(S,{layout:b})})]}),t.jsx(c.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:t.jsx(K,{})})]})]}),t.jsx(_,{onProceed:i})]})})]})},E=st(m.Trigger)`
  text-transform: uppercase;
`,ut=(a,n)=>{const o=a?.status,e=n?.availableStatus??[];return o?o==="draft"&&e.find(s=>s.publishedAt!==null)?"published":o:"draft"},yt=()=>{const{slug:a=""}=W(),{permissions:n=[],isLoading:o,error:e}=X(at.map(s=>({action:s,subject:a})));return o?t.jsx(d.Loading,{}):e||!a?t.jsx(d.Error,{}):t.jsx(d.Protect,{permissions:n,children:({permissions:s})=>t.jsx(Z,{permissions:s,children:t.jsx(ct,{})})})};export{ct as EditViewPage,yt as ProtectedEditViewPage};
