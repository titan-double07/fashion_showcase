import{j as e,P as N,hj as J,R as $e,a as de,av as pe,r as F,h as K,aX as B,aw as fe,k as V,a$ as xe,hk as Be,gy as je,hl as Ie,gB as Pe,bC as be,m as ie,bo as ye,L as q,S as Y,bs as ke,b as Re,cK as H,B as X,bj as Oe,b2 as Q,bB as Me,hm as re,hn as Ue,ho as Ne,bm as oe,bx as Fe,by as He,d as I,a9 as We,c9 as Ce,ca as Te,Q as ce,a6 as Ge,F as x,T as j,fk as le,gA as Se,M as U,N as Qe,O as _e,U as w,X as qe,ad as Ye,ae as Ze,an as Xe,bz as Z,hp as Je,aF as Ke,hq as Ve,gU as et,bH as tt,cx as st,hr as at,hs as nt,e as it,bl as rt,ag as ot,ah as lt,b1 as W,x as dt,A as G,ht as ct,hu as se,hv as ut,hw as gt,b7 as ht,b8 as mt,hx as pt,gV as ft,C as xt,bv as jt,cc as bt,cd as yt,hy as Rt,d1 as Mt,hz as Ct,bk as Tt,hA as ae,dE as St}from"./strapi-BZZ6vgbi.js";import{f as ne}from"./index-CltCu6NB.js";import{t as zt,a as Dt,R as wt,z as At}from"./schemas-DdA2ic2U-DFeXD1Kx.js";import{f as Lt}from"./index-ZDqKIJys.js";import"./index-BRVyLNfZ.js";function ze(t,s,u){var a=zt(t,u),i=Dt(s,a,!0),r=new Date(a.getTime()-i),h=new Date(0);return h.setFullYear(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate()),h.setHours(r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds()),h}const vt=["years","months","days","hours","minutes","seconds"],De=F.forwardRef(({timestamp:t,customIntervals:s=[],...u},a)=>{const{formatRelativeTime:i,formatDate:r,formatTime:h}=B(),l=bt({start:t,end:Date.now()}),m=vt.find(n=>l[n]>0&&Object.keys(l).includes(n)),d=yt(t)?-l[m]:l[m],b=s.find(n=>l[n.unit]<n.threshold),y=b?b.text:i(d,m,{numeric:"auto"});return e.jsx("time",{ref:a,dateTime:t.toISOString(),role:"time",title:`${r(t)} ${h(t)}`,...u,children:y})}),we=({handleClose:t,open:s,handleSubmit:u,initialValues:a,isLoading:i=!1})=>{const{formatMessage:r}=B(),{pathname:h}=pe(),l=h===`/plugins/${ut}`,{timezoneList:m,systemTimezone:d={value:"UTC+00:00-Africa/Abidjan "}}=Se(a.scheduledAt?new Date(a.scheduledAt):new Date),b=n=>{const{date:g,time:S,timezone:p}=n;if(!g||!S||!p)return null;const R=p.split("&")[1];return At(`${g} ${S}`,R)},y=()=>m.find(g=>g.value.split("&")[1]===a.timezone)?.value||d.value;return e.jsx(U.Root,{open:s,onOpenChange:t,children:e.jsxs(U.Content,{children:[e.jsx(U.Header,{children:e.jsx(U.Title,{children:r({id:"content-releases.modal.title",defaultMessage:"{isCreatingRelease, select, true {New release} other {Edit release}}"},{isCreatingRelease:l})})}),e.jsx(Qe,{onSubmit:n=>{u({...n,timezone:n.timezone?n.timezone.split("&")[1]:null,scheduledAt:n.isScheduled?b(n):null})},initialValues:{...a,timezone:a.timezone?y():d.value},validationSchema:wt,validateOnChange:!1,children:({values:n,errors:g,handleChange:S,setFieldValue:p})=>e.jsxs(_e,{children:[e.jsx(U.Body,{children:e.jsxs(x,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsxs(w.Root,{name:"name",error:g.name&&r({id:g.name,defaultMessage:g.name}),required:!0,children:[e.jsx(w.Label,{children:r({id:"content-releases.modal.form.input.label.release-name",defaultMessage:"Name"})}),e.jsx(qe,{value:n.name,onChange:S}),e.jsx(w.Error,{})]}),e.jsx(X,{width:"max-content",children:e.jsx(Ye,{name:"isScheduled",checked:n.isScheduled,onCheckedChange:R=>{p("isScheduled",R),R?(p("date",a.date),p("time",a.time),p("timezone",a.timezone??d?.value)):(p("date",null),p("time",""),p("timezone",null))},children:e.jsx(j,{textColor:n.isScheduled?"primary600":"neutral800",fontWeight:n.isScheduled?"semiBold":"regular",children:r({id:"modal.form.input.label.schedule-release",defaultMessage:"Schedule release"})})})}),n.isScheduled&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{gap:4,alignItems:"start",children:[e.jsx(X,{width:"100%",children:e.jsxs(w.Root,{name:"date",error:g.date&&r({id:g.date,defaultMessage:g.date}),required:!0,children:[e.jsx(w.Label,{children:r({id:"content-releases.modal.form.input.label.date",defaultMessage:"Date"})}),e.jsx(Ze,{onChange:R=>{const z=R?Lt(R,{representation:"date"}):null;p("date",z)},clearLabel:r({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{p("date",null)},value:n.date?new Date(n.date):new Date,minDate:ze(new Date,n.timezone.split("&")[1])}),e.jsx(w.Error,{})]})}),e.jsx(X,{width:"100%",children:e.jsxs(w.Root,{name:"time",error:g.time&&r({id:g.time,defaultMessage:g.time}),required:!0,children:[e.jsx(w.Label,{children:r({id:"content-releases.modal.form.input.label.time",defaultMessage:"Time"})}),e.jsx(Xe,{onChange:R=>{p("time",R)},clearLabel:r({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{p("time","")},value:n.time||void 0}),e.jsx(w.Error,{})]})})]}),e.jsx(Et,{timezoneOptions:m})]})]})}),e.jsxs(U.Footer,{children:[e.jsx(U.Close,{children:e.jsx(Y,{variant:"tertiary",name:"cancel",children:r({id:"cancel",defaultMessage:"Cancel"})})}),e.jsx(Y,{name:"submit",loading:i,type:"submit",children:r({id:"content-releases.modal.form.button.submit",defaultMessage:"{isCreatingRelease, select, true {Continue} other {Save}}"},{isCreatingRelease:l})})]})]})})]})})},Et=({timezoneOptions:t})=>{const{values:s,errors:u,setFieldValue:a}=gt(),{formatMessage:i}=B(),[r,h]=F.useState(t);return F.useEffect(()=>{if(s.date){const{timezoneList:l}=Se(new Date(s.date));h(l);const m=s.timezone&&l.find(d=>d.value.split("&")[1]===s.timezone.split("&")[1]);m&&a("timezone",m.value)}},[a,s.date,s.timezone]),e.jsxs(w.Root,{name:"timezone",error:u.timezone&&i({id:u.timezone,defaultMessage:u.timezone}),required:!0,children:[e.jsx(w.Label,{children:i({id:"content-releases.modal.form.input.label.timezone",defaultMessage:"Timezone"})}),e.jsx(ht,{autocomplete:{type:"list",filter:"contains"},value:s.timezone||void 0,textValue:s.timezone?s.timezone.replace(/&/," "):void 0,onChange:l=>{a("timezone",l)},onTextValueChange:l=>{a("timezone",l)},onClear:()=>{a("timezone","")},children:r.map(l=>e.jsx(mt,{value:l.value,children:l.value.replace(/&/," ")},l.value))}),e.jsx(w.Error,{})]})},$t=Ke,Ae=t=>typeof t<"u"&&t.name!==void 0,Bt=I(Re)`
  display: block;
`,It=I(De)`
  display: inline-block;
  &::first-letter {
    text-transform: uppercase;
  }
`,Le=t=>{let s;switch(t){case"ready":s="success";break;case"blocked":s="warning";break;case"failed":s="danger";break;case"done":s="primary";break;case"empty":default:s="neutral"}return{textColor:`${s}600`,backgroundColor:`${s}100`,borderColor:`${s}200`}},ue=({sectionTitle:t,releases:s=[],isError:u=!1})=>{const{formatMessage:a}=B();return u?e.jsx(N.Error,{}):s?.length===0?e.jsx(Ce,{content:a({id:"content-releases.page.Releases.tab.emptyEntries",defaultMessage:"No releases"},{target:t}),icon:e.jsx(Te,{width:"16rem"})}):e.jsx(ce.Root,{gap:4,children:s.map(({id:i,name:r,scheduledAt:h,status:l})=>e.jsx(ce.Item,{col:3,s:6,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(Bt,{tag:Ge,to:`${i}`,isExternal:!1,children:e.jsxs(x,{direction:"column",justifyContent:"space-between",padding:4,hasRadius:!0,background:"neutral0",shadow:"tableShadow",height:"100%",width:"100%",alignItems:"start",gap:4,children:[e.jsxs(x,{direction:"column",alignItems:"start",gap:1,children:[e.jsx(j,{textColor:"neutral800",tag:"h3",variant:"delta",fontWeight:"bold",children:r}),e.jsx(j,{variant:"pi",textColor:"neutral600",children:h?e.jsx(It,{timestamp:new Date(h)}):a({id:"content-releases.pages.Releases.not-scheduled",defaultMessage:"Not scheduled"})})]}),e.jsx(le,{...Le(l),children:l})]})})},i))})},Pt=I(We)`
  button {
    display: none;
  }
  p + div {
    margin-left: auto;
  }
`,kt={name:"",date:ne(new Date,"yyyy-MM-dd"),time:"",isScheduled:!0,scheduledAt:null,timezone:null},Ot=()=>{const t=pe(),[s,u]=F.useState(!1),{toggleNotification:a}=K(),{formatMessage:i}=B(),r=fe(),{formatAPIError:h}=V(),[{query:l},m]=xe(),d=Be(l),{data:b,isLoading:y}=je(),[n,{isLoading:g}]=Ie(),{getFeature:S}=Pe(),{maximumReleases:p=3}=S("cms-content-releases"),{trackUsage:R}=be(),{allowedActions:{canCreate:z}}=ie(J),{isLoading:v,isSuccess:A,isError:o}=d,k=d?.currentData?.meta?.activeTab||"pending";F.useEffect(()=>{t?.state?.errors&&(a({type:"danger",title:i({id:"content-releases.pages.Releases.notification.error.title",defaultMessage:"Your request could not be processed."}),message:i({id:"content-releases.pages.Releases.notification.error.message",defaultMessage:"Please try again or open another release."})}),r("",{replace:!0,state:null}))},[i,t?.state?.errors,r,a]);const T=()=>{u(D=>!D)};if(v||y)return e.jsx(N.Loading,{});const M=A&&d.currentData?.meta?.pendingReleasesCount||0,P=M>=p,O=D=>{m({...l,page:1,pageSize:d?.currentData?.meta?.pagination?.pageSize||16,filters:{releasedAt:{$notNull:D!=="pending"}}})},E=async({name:D,scheduledAt:C,timezone:c})=>{const f=await n({name:D,scheduledAt:C,timezone:c});"data"in f?(a({type:"success",message:i({id:"content-releases.modal.release-created-notification-success",defaultMessage:"Release created."})}),R("didCreateRelease"),r(f.data.data.id.toString())):Z(f.error)?a({type:"danger",message:h(f.error)}):a({type:"danger",message:i({id:"notification.error",defaultMessage:"An error occurred"})})};return e.jsxs(ye,{"aria-busy":v||y,children:[e.jsx(q.Header,{title:i({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"}),subtitle:i({id:"content-releases.pages.Releases.header-subtitle",defaultMessage:"Create and manage content updates"}),primaryAction:z?e.jsx(Y,{startIcon:e.jsx(ke,{}),onClick:T,disabled:P,children:i({id:"content-releases.header.actions.add-release",defaultMessage:"New release"})}):null}),e.jsx(q.Content,{children:e.jsxs(e.Fragment,{children:[P&&e.jsx(Pt,{marginBottom:6,action:e.jsx(Re,{href:"https://strapi.io/pricing-cloud",isExternal:!0,children:i({id:"content-releases.pages.Releases.max-limit-reached.action",defaultMessage:"Explore plans"})}),title:i({id:"content-releases.pages.Releases.max-limit-reached.title",defaultMessage:"You have reached the {number} pending {number, plural, one {release} other {releases}} limit."},{number:p}),onClose:()=>{},closeLabel:"",children:i({id:"content-releases.pages.Releases.max-limit-reached.message",defaultMessage:"Upgrade to manage an unlimited number of releases."})}),e.jsxs(H.Root,{variant:"simple",onValueChange:O,value:k,children:[e.jsxs(X,{paddingBottom:8,children:[e.jsxs(H.List,{"aria-label":i({id:"content-releases.pages.Releases.tab-group.label",defaultMessage:"Releases list"}),children:[e.jsx(H.Trigger,{value:"pending",children:i({id:"content-releases.pages.Releases.tab.pending",defaultMessage:"Pending ({count})"},{count:M})}),e.jsx(H.Trigger,{value:"done",children:i({id:"content-releases.pages.Releases.tab.done",defaultMessage:"Done"})})]}),e.jsx(Oe,{})]}),e.jsx(H.Content,{value:"pending",children:e.jsx(ue,{sectionTitle:"pending",releases:d?.currentData?.data,isError:o})}),e.jsx(H.Content,{value:"done",children:e.jsx(ue,{sectionTitle:"done",releases:d?.currentData?.data,isError:o})})]}),e.jsxs(Q.Root,{...d?.currentData?.meta?.pagination,defaultPageSize:d?.currentData?.meta?.pagination?.pageSize,children:[e.jsx(Q.PageSize,{options:["8","16","32","64"]}),e.jsx(Q.Links,{})]})]})}),e.jsx(we,{open:s,handleClose:T,handleSubmit:E,isLoading:g,initialValues:{...kt,timezone:b?.data.defaultTimezone?b.data.defaultTimezone.split("&")[1]:null}})]})},Ut=I(x)`
  align-self: stretch;
  border-bottom-right-radius: ${({theme:t})=>t.borderRadius};
  border-bottom-left-radius: ${({theme:t})=>t.borderRadius};
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,ge=I(ft)`
  svg path {
    fill: ${({theme:t,disabled:s})=>s&&t.colors.neutral500};
  }
  span {
    color: ${({theme:t,disabled:s})=>s&&t.colors.neutral500};
  }

  &:hover {
    background: ${({theme:t,$variant:s="neutral"})=>t.colors[`${s}100`]};
  }
`,Nt=I(xt)`
  width: ${({theme:t})=>t.spaces[4]};
  height: ${({theme:t})=>t.spaces[4]};
  path {
    fill: ${({theme:t})=>t.colors.neutral600};
  }
`,Ft=I(jt)`
  width: ${({theme:t})=>t.spaces[4]};
  height: ${({theme:t})=>t.spaces[4]};
  path {
    fill: ${({theme:t})=>t.colors.danger600};
  }
`,Ht=I(j)`
  max-width: 300px;
`,Wt=({action:t,schema:s,entry:u,status:a})=>{const{formatMessage:i}=B(),{validate:r,isLoading:h}=Mt({collectionType:s?.kind??"",model:s?.uid??""},{skip:!0}),l=(d,b="")=>Object.keys(d).length===0?"":Object.entries(d).map(([y,n])=>n==null?"":typeof n=="string"?i({id:n,defaultMessage:n},{field:b?`${b}.${y}`:y}):typeof n=="object"&&n!==null&&"id"in n&&"defaultMessage"in n?i({id:`${n.id}.withField`,defaultMessage:n.defaultMessage},{field:b?`${b}.${y}`:y}):l(n,y)).join(" ");if(h)return null;const m=r(u)??{};if(t==="publish"){if(Object.keys(m).length>0){const d=l(m);return e.jsxs(x,{gap:2,children:[e.jsx(Ct,{fill:"danger600"}),e.jsx(Tt,{description:d,children:e.jsx(Ht,{textColor:"danger600",variant:"omega",fontWeight:"semiBold",ellipsis:!0,children:d})})]})}if(a==="draft")return e.jsxs(x,{gap:2,children:[e.jsx(ae,{fill:"success600"}),e.jsx(j,{children:i({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-publish",defaultMessage:"Ready to publish"})})]});if(a==="modified")return e.jsxs(x,{gap:2,children:[e.jsx(St,{fill:"alternative600"}),e.jsx(j,{children:i({id:"content-releases.pages.ReleaseDetails.entry-validation.modified",defaultMessage:"Ready to publish changes"})})]});if(a==="published")return e.jsxs(x,{gap:2,children:[e.jsx(ae,{fill:"success600"}),e.jsx(j,{children:i({id:"content-releases.pages.ReleaseDetails.entry-validation.already-published",defaultMessage:"Already published"})})]})}return e.jsxs(x,{gap:2,children:[e.jsx(ae,{fill:"success600"}),u.publishedAt?e.jsx(j,{children:i({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-unpublish",defaultMessage:"Ready to unpublish"})}):e.jsx(j,{textColor:"success600",fontWeight:"bold",children:i({id:"content-releases.pages.ReleaseDetails.entry-validation.already-unpublished",defaultMessage:"Already unpublished"})})]})},he=({toggleEditReleaseModal:t,toggleWarningSubmit:s,children:u})=>{const{formatMessage:a,formatDate:i,formatTime:r}=B(),{releaseId:h}=Me(),{data:l,isLoading:m,error:d}=re({id:h},{skip:!h}),[b,{isLoading:y}]=Je(),{toggleNotification:n}=K(),{formatAPIError:g}=V(),{allowedActions:S}=ie(J),{canUpdate:p,canDelete:R,canPublish:z}=S,v=$t(),{trackUsage:A}=be(),o=l?.data,k=c=>async()=>{const f=await b({id:c});if("data"in f){n({type:"success",message:a({id:"content-releases.pages.ReleaseDetails.publish-notification-success",defaultMessage:"Release was published successfully."})});const{totalEntries:L,totalPublishedEntries:$,totalUnpublishedEntries:_}=f.data.meta;A("didPublishRelease",{totalEntries:L,totalPublishedEntries:$,totalUnpublishedEntries:_})}else Z(f.error)?n({type:"danger",message:g(f.error)}):n({type:"danger",message:a({id:"notification.error",defaultMessage:"An error occurred"})})},T=()=>{v(Rt.util.invalidateTags([{type:"ReleaseAction",id:"LIST"},{type:"Release",id:h}]))},M=()=>o?.createdBy?o.createdBy.username?o.createdBy.username:o.createdBy.firstname?`${o.createdBy.firstname} ${o.createdBy.lastname||""}`.trim():o.createdBy.email:null;if(m)return e.jsx(N.Loading,{});if(Ae(d)&&"code"in d||!o)return e.jsx(oe,{to:"..",state:{errors:[{code:d?.code}]}});const P=o.actions.meta.count||0,O=!!M(),E=o.scheduledAt&&o.timezone,D=a({id:"content-releases.pages.Details.header-subtitle",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:P}),C=E?a({id:"content-releases.pages.ReleaseDetails.header-subtitle.scheduled",defaultMessage:"Scheduled for {date} at {time} ({offset})"},{date:i(new Date(o.scheduledAt),{weekday:"long",day:"numeric",month:"long",year:"numeric",timeZone:o.timezone}),time:r(new Date(o.scheduledAt),{timeZone:o.timezone,hourCycle:"h23"}),offset:Ve(o.timezone,new Date(o.scheduledAt))}):"";return e.jsxs(ye,{"aria-busy":m,children:[e.jsx(q.Header,{title:o.name,subtitle:e.jsxs(x,{gap:2,lineHeight:6,children:[e.jsx(j,{textColor:"neutral600",variant:"epsilon",children:D+(E?` - ${C}`:"")}),e.jsx(le,{...Le(o.status),children:o.status})]}),navigationAction:e.jsx(tt,{}),primaryAction:!o.releasedAt&&e.jsxs(x,{gap:2,children:[e.jsxs(Gt,{label:e.jsx(et,{}),variant:"tertiary",endIcon:null,paddingLeft:"7px",paddingRight:"7px","aria-label":a({id:"content-releases.header.actions.open-release-actions",defaultMessage:"Release edit and delete menu"}),popoverPlacement:"bottom-end",children:[e.jsx(ge,{disabled:!p,onSelect:t,children:e.jsxs(x,{alignItems:"center",gap:2,hasRadius:!0,width:"100%",children:[e.jsx(Nt,{}),e.jsx(j,{ellipsis:!0,children:a({id:"content-releases.header.actions.edit",defaultMessage:"Edit"})})]})}),e.jsx(ge,{disabled:!R,onSelect:s,$variant:"danger",children:e.jsxs(x,{alignItems:"center",gap:2,hasRadius:!0,width:"100%",children:[e.jsx(Ft,{}),e.jsx(j,{ellipsis:!0,textColor:"danger600",children:a({id:"content-releases.header.actions.delete",defaultMessage:"Delete"})})]})}),e.jsxs(Ut,{direction:"column",justifyContent:"center",alignItems:"flex-start",gap:1,padding:4,children:[e.jsx(j,{variant:"pi",fontWeight:"bold",children:a({id:"content-releases.header.actions.created",defaultMessage:"Created"})}),e.jsxs(j,{variant:"pi",color:"neutral300",children:[e.jsx(De,{timestamp:new Date(o.createdAt)}),a({id:"content-releases.header.actions.created.description",defaultMessage:"{hasCreatedByUser, select, true { by {createdBy}} other { by deleted user}}"},{createdBy:M(),hasCreatedByUser:O})]})]})]}),e.jsx(Y,{size:"S",variant:"tertiary",onClick:T,children:a({id:"content-releases.header.actions.refresh",defaultMessage:"Refresh"})}),z?e.jsx(Y,{size:"S",variant:"default",onClick:k(o.id.toString()),loading:y,disabled:o.actions.meta.count===0,children:a({id:"content-releases.header.actions.publish",defaultMessage:"Publish"})}):null]})}),u]})},Gt=I(pt)`
  & > span {
    display: flex;
  }
`,Qt=["contentType","locale","action"],_t=["contentType","action"],me=t=>t==="locale"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.locales",defaultMessage:"Locales"}:t==="action"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.actions",defaultMessage:"Actions"}:{id:"content-releases.pages.ReleaseDetails.groupBy.option.content-type",defaultMessage:"Content-Types"},qt=({releaseId:t})=>{const{formatMessage:s}=B(),[{query:u},a]=xe(),{toggleNotification:i}=K(),{formatAPIError:r}=V(),{data:h,isLoading:l,error:m}=re({id:t}),{allowedActions:{canUpdate:d}}=ie(J),b=st("ReleaseDetailsPage",c=>c.runHookWaterfall),{displayedHeaders:y,hasI18nEnabled:n}=b("ContentReleases/pages/ReleaseDetails/add-locale-in-releases",{displayedHeaders:[{label:{id:"content-releases.page.ReleaseDetails.table.header.label.name",defaultMessage:"name"},name:"name"}],hasI18nEnabled:!1}),g=h?.data,S=u?.groupBy||"contentType",{isLoading:p,isFetching:R,isError:z,data:v,error:A}=at({...u,releaseId:t}),[o]=nt(),k=async(c,f,L)=>{const $=await o({params:{releaseId:t,actionId:f},body:{type:c.target.value},query:u,actionPath:L});"error"in $&&(Z($.error)?i({type:"danger",message:r($.error)}):i({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occurred"})}))};if(p||l)return e.jsx(N.Loading,{});const T=v?.data,M=v?.meta,P=M?.contentTypes||{},O=M?.components||{};if(Ae(m)||!g){const c=[];return m&&"code"in m&&c.push({code:m.code}),A&&"code"in A&&c.push({code:A.code}),e.jsx(oe,{to:"..",state:{errors:c}})}if(z||!T)return e.jsx(N.Error,{});if(Object.keys(T).length===0)return e.jsx(q.Content,{children:e.jsx(Ce,{action:e.jsx(it,{tag:rt,to:{pathname:"/content-manager"},style:{textDecoration:"none"},variant:"secondary",children:s({id:"content-releases.page.Details.button.openContentManager",defaultMessage:"Open the Content Manager"})}),icon:e.jsx(Te,{width:"16rem"}),content:s({id:"content-releases.pages.Details.tab.emptyEntries",defaultMessage:"This release is empty. Open the Content Manager, select an entry and add it to the release."})})});const E=s({id:"content-releases.pages.ReleaseDetails.groupBy.aria-label",defaultMessage:"Group by"}),D=[...y,{label:{id:"content-releases.page.ReleaseDetails.table.header.label.content-type",defaultMessage:"content-type"},name:"content-type"},{label:{id:"content-releases.page.ReleaseDetails.table.header.label.action",defaultMessage:"action"},name:"action"},...g.releasedAt?[]:[{label:{id:"content-releases.page.ReleaseDetails.table.header.label.status",defaultMessage:"status"},name:"status"}]],C=n?Qt:_t;return e.jsx(q.Content,{children:e.jsxs(x,{gap:8,direction:"column",alignItems:"stretch",children:[e.jsx(x,{children:e.jsx(ot,{placeholder:E,"aria-label":E,customizeContent:c=>s({id:"content-releases.pages.ReleaseDetails.groupBy.label",defaultMessage:"Group by {groupBy}"},{groupBy:c}),value:s(me(S)),onChange:c=>a({groupBy:c}),children:C.map(c=>e.jsx(lt,{value:c,children:s(me(c))},c))})}),Object.keys(T).map(c=>e.jsxs(x,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsx(x,{role:"separator","aria-label":c,children:e.jsx(le,{children:c})}),e.jsx(W.Root,{rows:T[c].map(f=>({...f,id:Number(f.entry.id)})),headers:D,isLoading:p||R,children:e.jsxs(W.Content,{children:[e.jsx(W.Head,{children:D.map(({label:f,name:L})=>e.jsx(W.HeaderCell,{label:s(f),name:L},L))}),e.jsx(W.Loading,{}),e.jsx(W.Body,{children:T[c].map(({id:f,contentType:L,locale:$,type:_,entry:ee,status:ve},Ee)=>e.jsxs(dt,{children:[e.jsx(G,{width:"25%",maxWidth:"200px",children:e.jsx(j,{ellipsis:!0,children:`${L.mainFieldValue||ee.id}`})}),n&&e.jsx(G,{width:"10%",children:e.jsx(j,{children:`${$?.name?$.name:"-"}`})}),e.jsx(G,{width:"10%",children:e.jsx(j,{children:L.displayName||""})}),e.jsx(G,{width:"20%",children:g.releasedAt?e.jsx(j,{children:s({id:"content-releases.page.ReleaseDetails.table.action-published",defaultMessage:"This entry was <b>{isPublish, select, true {published} other {unpublished}}</b>."},{isPublish:_==="publish",b:te=>e.jsx(j,{fontWeight:"bold",children:te})})}):e.jsx(ct,{selected:_,handleChange:te=>k(te,f,[c,Ee]),name:`release-action-${f}-type`,disabled:!d})}),!g.releasedAt&&e.jsxs(e.Fragment,{children:[e.jsx(G,{width:"20%",minWidth:"200px",children:e.jsx(Wt,{action:_,schema:P?.[L.uid],components:O,entry:ee,status:ve})}),e.jsx(G,{children:e.jsx(x,{justifyContent:"flex-end",children:e.jsxs(se.Root,{children:[e.jsx(se.ReleaseActionEntryLinkItem,{contentTypeUid:L.uid,documentId:ee.documentId,locale:$?.code}),e.jsx(se.DeleteReleaseActionItem,{releaseId:g.id,actionId:f})]})})})]})]},f))})]})})]},`releases-group-${c}`)),e.jsxs(Q.Root,{...M?.pagination,defaultPageSize:M?.pagination?.pageSize,children:[e.jsx(Q.PageSize,{}),e.jsx(Q.Links,{})]})]})})},Yt=()=>{const{formatMessage:t}=B(),{releaseId:s}=Me(),{toggleNotification:u}=K(),{formatAPIError:a}=V(),i=fe(),[r,h]=F.useState(!1),[l,m]=F.useState(!1),{isLoading:d,data:b,isSuccess:y}=re({id:s},{skip:!s}),{data:n,isLoading:g}=je(),[S,{isLoading:p}]=Ue(),[R]=Ne(),z=()=>{h(C=>!C)},v=()=>o?.timezone?o.timezone:n?.data.defaultTimezone?n.data.defaultTimezone:null,A=()=>m(C=>!C);if(d||g)return e.jsx(he,{toggleEditReleaseModal:z,toggleWarningSubmit:A,children:e.jsx(N.Loading,{})});if(!s)return e.jsx(oe,{to:".."});const o=y&&b?.data||null,k=o?.name||"",T=v(),M=o?.scheduledAt&&T?ze(o.scheduledAt,T):null,P=M?ne(M,"yyyy-MM-dd"):void 0,O=M?ne(M,"HH:mm"):"",E=async C=>{const c=await S({id:s,name:C.name,scheduledAt:C.scheduledAt,timezone:C.timezone});"data"in c?(u({type:"success",message:t({id:"content-releases.modal.release-updated-notification-success",defaultMessage:"Release updated."})}),z()):Z(c.error)?u({type:"danger",message:a(c.error)}):u({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})},D=async()=>{const C=await R({id:s});"data"in C?i(".."):Z(C.error)?u({type:"danger",message:a(C.error)}):u({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})})};return e.jsxs(he,{toggleEditReleaseModal:z,toggleWarningSubmit:A,children:[e.jsx(qt,{releaseId:s}),e.jsx(we,{open:r,handleClose:z,handleSubmit:E,isLoading:d||p,initialValues:{name:k||"",scheduledAt:M,date:P,time:O,isScheduled:!!M,timezone:T}}),e.jsx(Fe.Root,{open:l,onOpenChange:A,children:e.jsx(He,{onConfirm:D,children:t({id:"content-releases.dialog.confirmation-message",defaultMessage:"Are you sure you want to delete this release?"})})})]})},es=()=>e.jsx(N.Protect,{permissions:J.main,children:e.jsxs($e,{children:[e.jsx(de,{index:!0,element:e.jsx(Ot,{})}),e.jsx(de,{path:":releaseId",element:e.jsx(Yt,{})})]})});export{es as App};
